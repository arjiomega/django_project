{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>Recommend</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/habibmhamadi/multi-select-tag/dist/css/multi-select-tag.css">
  
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.6.4/js/bootstrap-datepicker.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.6.4/css/bootstrap-datepicker.css" rel="stylesheet"/>

  <style>
    label {
        cursor: pointer;
        filter: grayscale(100%);
      }
      
      label:hover {
        filter: grayscale(0);
      }
      input[type="radio"] {
        display: none; /* hide the radio button */
      }
  </style>
</head>
    <body>

        <nav class="navbar navbar-expand-lg bg-light">
            <div class="container-fluid">
                <a class="navbar-brand" href="{% url 'home_view' %}">Movie Recommender System</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarText">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="{% url 'userrating_list' %}">GET</a>
                    </li>
                    <li class="nav-item">
                    <a class="nav-link" href="{% url 'enter' %}">Register</a>
                    </li>
                    <li class="nav-item">
                    <a class="nav-link" href="#">Recommend</a>
                    </li>
                </ul>
                <span class="navbar-text">

                </span>
                </div>
            </div>
        </nav>

        <div class="container mt-5">
            <form method="GET" action="{% url 'update' %}">
                {% csrf_token %}
                <h3>Genre</h3>
                <select name="genres[]" id="genres" multiple>
                    {% for genre in genres %}
                        <option>{{genre}}</option>
                    {% endfor %}
                </select>
                <h3 class='mt-3'>Year</h3>
                <input type="text" class="form-control mt-1" name="datepicker" id="datepicker" />
            
                <button type="submit" class="btn btn-light mt-3">Display</button>
            </form>

            {% comment %} <div class="choose mt-5">
                <h3>Genres</h3>
                <p>{{genres_text}}</p>
                <h3>Year: {{year}}</h3>
                {% if movie.poster %}
  
                    <div class="row row-cols-4 row-cols-lg-4">
                        {% for link in movie.poster %}
                            <div class="col mb-3">
                                <form id="my-form-{{forloop.counter}}" method="POST" action="{% url 'update' %}">
                                    {% csrf_token %}
                                    <input type="radio" name="gender" class="sr-only" id="male{{forloop.counter}}" value="{{forloop.counter}}">
                                    <label for="male{forloop.counter}">
                                        <img src="https://image.tmdb.org/t/p/w185{{link}}" alt="male">
                                    </label>
                                </form>
                            </div>
                        {% endfor %}
                    </div>
                    <button type="submit" class="btn btn-light mt-3">Add to List</button>
                </form>
                {% endif %}
            </div> {% endcomment %}
            <form id="my-form">
                {% csrf_token %}
                <div class="row row-cols-4 row-cols-lg-4">
                    {% for movie in movies %}
                        {% if movie.id not in temp_list%}
                            <div class="col mb-4">
                                <input type="radio" name="gender" value="{{ movie.id }}" class="sr-only" id="male{{ forloop.counter }}">
                                <label for="male{{ forloop.counter }}">
                                    <img src="https://image.tmdb.org/t/p/w185{{movie.poster_path}}" alt="{{movie.original_title}}">
                                </label>
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
            </form>

            <fieldset>
                <legend>
                    Please select gender
                </legend>
                <input type="radio" name="gender" class="sr-only" id="male">
                <label for="male">
                    <img src="http://findicons.com/files/icons/1688/web_blog/48/user_male_white_red_brown.png" alt="male">
                </label>
                <input type="radio" name="gender" class="sr-only" id="female">
                <label for="female">
                    <img src="http://findicons.com/files/icons/1688/web_blog/48/user_female_white_pink_black.png" alt="female">
                </label>
            </fieldset>


        </div>

    
        
        <script src="https://cdn.jsdelivr.net/gh/habibmhamadi/multi-select-tag/dist/js/multi-select-tag.js"></script>
        <script>
            new MultiSelectTag('genres')  // id
        </script>
        <script>
            $("#datepicker").datepicker({
                format: "yyyy",
                viewMode: "years", 
                minViewMode: "years"
            });
        </script>

        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script>
            // JavaScript code
            $(document).ready(function() {
                $('#my-form input[type="radio"]').on('change', function() {
                    var selectedLink = $('input[name="gender"]:checked').val();
                    $(this).closest('.col').remove();
                    $.ajax({
                        url: '{% url "update" %}',
                        type: 'POST',
                        data: {
                            'link': selectedLink,
                            'csrfmiddlewaretoken': $('input[name="csrfmiddlewaretoken"]').val()
                        },
                        success: function(response) {
                            console.log(response);
                        },
                        error: function(xhr) {
                            console.log(xhr.responseText);
                        }
                    });
                });
            });
        </script>
</body>
</html>